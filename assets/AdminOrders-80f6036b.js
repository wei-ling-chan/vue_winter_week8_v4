import{_ as f,o,a as d,b as t,t as l,h as p,F as h,l as b,bs as g,bf as v,g as k,k as A,d as $,r as O,n as D}from"./index-9a31f6fa.js";import{S as P}from"./SweetAlert-1efc7ab7.js";import{M}from"./modal-df636345.js";import"./sweetalert2.all-f8312059.js";import"./base-component-e3196cd5.js";const E={props:["order"],data(){return{modal:"",tempOrder:{}}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},changestatus(e){this.$emit("change-status",e)},formattedDate(e,n){return new Date(e*1e3).toLocaleDateString(void 0,{dateFormat:n})}},watch:{order(){this.tempOrder=this.order}},mounted(){this.modal=new M(this.$refs.ordermodal)}},S={class:"modal fade",id:"orderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"ordermodal"},V={class:"modal-dialog modal-xl",role:"document"},L={class:"modal-content border-0"},T=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),I={class:"modal-body"},U={class:"row"},B={class:"col-md-4"},F=t("h3",null,"用戶資料",-1),N={class:"table"},R={key:0},z=t("th",{style:{width:"100px"}},"姓名",-1),q=t("th",null,"Email",-1),H=t("th",null,"電話",-1),j=t("th",null,"地址",-1),G={class:"col-md-8"},J=t("h3",null,"訂單細節",-1),K={class:"table"},Q=t("th",{style:{width:"100px"}},"訂單編號",-1),W=t("th",null,"下單時間",-1),X=t("th",null,"付款時間",-1),Y={key:0},Z={key:1},tt=t("th",null,"付款狀態",-1),et={key:0,class:"text-success"},st={key:1,class:"text-muted"},ot=t("th",null,"總金額",-1),dt=t("h3",null,"選購商品",-1),lt={class:"table"},nt=t("thead",null,[t("tr")],-1),rt=t("td",{class:"text-end"},null,-1),at={class:"d-flex justify-content-end"},it={class:"form-check"},ct={class:"form-check-label",for:"flexCheckDefault"},ht={key:0},ut={key:1},_t={class:"modal-footer"},mt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function pt(e,n,u,y,s,a){return o(),d("div",S,[t("div",V,[t("div",L,[T,t("div",I,[t("div",U,[t("div",B,[F,t("table",N,[s.tempOrder.user?(o(),d("tbody",R,[t("tr",null,[z,t("td",null,l(s.tempOrder.user.name),1)]),t("tr",null,[q,t("td",null,l(s.tempOrder.user.email),1)]),t("tr",null,[H,t("td",null,l(s.tempOrder.user.tel),1)]),t("tr",null,[j,t("td",null,l(s.tempOrder.user.address),1)])])):p("",!0)])]),t("div",G,[J,t("table",K,[t("tbody",null,[t("tr",null,[Q,t("td",null,l(s.tempOrder.id),1)]),t("tr",null,[W,t("td",null,l(a.formattedDate(s.tempOrder.create_at,"yyyy-MM-dd")),1)]),t("tr",null,[X,t("td",null,[s.tempOrder.paid_date?(o(),d("span",Y,l(a.formattedDate(s.tempOrder.paid_date,"yyyy-MM-dd")),1)):(o(),d("span",Z,"時間不正確"))])]),t("tr",null,[tt,t("td",null,[s.tempOrder.is_paid?(o(),d("strong",et,"已付款")):(o(),d("span",st,"尚未付款"))])]),t("tr",null,[ot,t("td",null,l(s.tempOrder.total),1)])])]),dt,t("table",lt,[nt,t("tbody",null,[(o(!0),d(h,null,b(s.tempOrder.products,i=>(o(),d("tr",{key:i.id},[t("th",null,l(i.product.title),1),t("td",null,l(i.qty)+" / "+l(i.product.unit),1),rt]))),128))])]),t("div",at,[t("div",it,[g(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=i=>s.tempOrder.is_paid=i)},null,512),[[v,s.tempOrder.is_paid]]),t("label",ct,[s.tempOrder.is_paid?(o(),d("span",ht,"已付款")):(o(),d("span",ut,"未付款"))])])])])])]),t("div",_t,[mt,t("button",{type:"button",class:"btn btn-info",onClick:n[1]||(n[1]=i=>a.changestatus(s.tempOrder))}," 修改付款狀態 ")])])])],512)}const bt=f(E,[["render",pt]]),ft={props:["order"],data(){return{tempOrder:{}}},methods:{delorder(){this.tempOrder=this.order},openModal(){this.modal.show()},hideModal(){this.modal.hide()}},watch:{order(){this.tempOrder=this.order}},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.modal=new M(this.$refs.delOrderModal)}},yt={class:"modal fade",id:"delOrderModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delOrderModal"},kt={class:"modal-dialog",role:"document"},$t={class:"modal-content border-0"},Ot={class:"modal-header bg-danger text-white"},gt={class:"modal-title"},vt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Mt={class:"modal-body"},xt={class:"text-danger"},Ct={class:"modal-footer"},wt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function At(e,n,u,y,s,a){return o(),d("div",yt,[t("div",kt,[t("div",$t,[t("div",Ot,[t("h5",gt,[t("span",null,"刪除 "+l(s.tempOrder.id),1)]),vt]),t("div",Mt,[k(" 是否刪除 "),t("strong",xt,l(s.tempOrder.id),1),k(" (刪除後將無法恢復)。 ")]),t("div",Ct,[wt,t("button",{type:"button",class:"btn btn-danger",onClick:n[0]||(n[0]=i=>e.$emit("del-item"))},"確認刪除 ")])])])],512)}const Dt=f(ft,[["render",At]]),{VITE_APP_URL:_,VITE_APP_PATH:m}={VITE_APP_URL:"https://vue3-course-api.hexschool.io",VITE_APP_PATH:"wlc606",BASE_URL:"/vue_winter_week8_v4/",MODE:"production",DEV:!1,PROD:!0},Pt={data(){return{adminOrders:[],tempOrder:{},currentPage:1,timestamp:"",orderComponent:"",delorderComponent:"",paid:{}}},components:{AdminOrdermodal:bt,DelOrdermodal:Dt},methods:{getAdminOrders(e=1){this.currentPage=e,this.$http.get(`${_}/v2/api/${m}/admin/orders?page=${e}`).then(n=>{this.adminOrders=n.data.orders,this.formattedDate()}).catch(n=>{this.showErrorAlert(n)})},updatePaid(e){this.paid={is_paid:e.is_paid},this.$http.put(`${_}/v2/api/${m}/admin/order/${e.id}`,{data:this.paid}).then(n=>{this.showSuccessAlert(n),this.orderComponent.hideModal(),this.getAdminOrders()})},delAdminOrder(){this.$http.delete(`${_}/v2/api/${m}/admin/order/${this.tempOrder.id}`).then(e=>{this.showSuccessAlert(e),this.delorderComponent.hideModal(),this.getAdminOrders()}).catch(e=>{this.showErrorAlert(e)})},openModal(e){this.tempOrder={...e},this.orderComponent=this.$refs.orderModal,this.orderComponent.openModal()},delOrderModal(e){this.tempOrder={...e},this.delorderComponent=this.$refs.delOrderModal,this.delorderComponent.openModal()},formattedDate(e,n){return new Date(e*1e3).toLocaleDateString(void 0,{dateFormat:n})},...A(P,["showSuccessAlert","showErrorAlert"])},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.getAdminOrders()}},Et=t("h1",null,"這是後台訂單列表",-1),St={class:"table mt-4"},Vt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Lt=["textContent"],Tt={class:"list-unstyled"},It={class:"text-right"},Ut={class:"form-check form-switch"},Bt=["id","onUpdate:modelValue","onChange"],Ft=["for"],Nt={key:0},Rt={key:1},zt={class:"btn-group"},qt=["onClick"],Ht=["onClick"];function jt(e,n,u,y,s,a){const i=O("AdminOrdermodal"),x=O("DelOrdermodal");return o(),d(h,null,[Et,t("table",St,[Vt,t("tbody",null,[(o(!0),d(h,null,b(s.adminOrders,(r,C)=>(o(),d(h,{key:C+"12345"},[s.adminOrders.length?(o(),d("tr",{key:0,class:D({"text-secondary":!r.is_paid})},[t("td",null,l(a.formattedDate(r.create_at,"yyyy-MM-dd")),1),t("td",null,[r.user?(o(),d("span",{key:0,textContent:l(r.user.email)},null,8,Lt)):p("",!0)]),t("td",null,[t("ul",Tt,[(o(!0),d(h,null,b(r.products,(c,w)=>(o(),d("li",{key:w+"111"},l(c.product.title)+" 數量："+l(c.qty)+" "+l(c.product.unit),1))),128))])]),t("td",It,l(r.total),1),t("td",null,[t("div",Ut,[g(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${r.id}`,"onUpdate:modelValue":c=>r.is_paid=c,onChange:c=>a.updatePaid(r)},null,40,Bt),[[v,r.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${r.id}`},[r.is_paid?(o(),d("span",Nt,"已付款")):(o(),d("span",Rt,"未付款"))],8,Ft)])]),t("td",null,[t("div",zt,[t("button",{class:"btn btn-outline-info btn-sm",type:"button",onClick:c=>a.openModal(r)}," 檢視 ",8,qt),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:c=>a.delOrderModal(r)}," 刪除 ",8,Ht)])])],2)):p("",!0)],64))),128))])]),$(i,{ref:"orderModal",order:s.tempOrder,onChangeStatus:a.updatePaid},null,8,["order","onChangeStatus"]),$(x,{ref:"delOrderModal",order:s.tempOrder,onDelItem:a.delAdminOrder},null,8,["order","onDelItem"])],64)}const Xt=f(Pt,[["render",jt]]);export{Xt as default};
