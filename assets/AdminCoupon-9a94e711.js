import{M as w}from"./modal-233b521d.js";import{k as h,_,o as d,a as i,b as o,bs as p,bj as r,bf as g,t as c,g as C,F as k,l as T,d as f,r as $}from"./index-01093b7f.js";import{S as m}from"./SweetAlert-5621248b.js";import"./base-component-1cb7e888.js";import"./sweetalert2.all-dbef9969.js";const{VITE_APP_URL:v,VITE_APP_PATH:P}={VITE_APP_URL:"https://vue3-course-api.hexschool.io",VITE_APP_PATH:"wlc606",BASE_URL:"/vue_winter_week8_v4/",MODE:"production",DEV:!1,PROD:!0},V={props:["isNew","coupon","getCoupons"],data(){return{tempCoupon:{title:"",is_enabled:1,percent:"",code:""},due_date:"",modal:"",couponeEdited:{}}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},creatCoupon(){if(this.tempCoupon.due_date=new Date(this.tempCoupon.due_date).getTime(),this.isNew===!0){this.hideModal();const e=this.tempCoupon;this.$http.post(`${v}/v2/api/${P}/admin/coupon`,{data:e}).then(t=>{this.getCoupons()}).catch(t=>{this.showErrorAlert(t)})}else if(this.isNew===!1){this.hideModal();const e=this.tempCoupon;this.$http.put(`${v}/v2/api/${P}/admin/coupon/${this.tempCoupon.id}`,{data:e}).then(t=>{this.getCoupons()}).catch(t=>{this.showErrorAlert(t)})}},...h(m,["showErrorAlert"])},watch:{coupon(){this.couponeEdited=this.coupon,this.couponeEdited.due_date=new Date(this.couponeEdited.due_date).toISOString().slice(0,10),this.tempCoupon=this.couponeEdited}},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.modal=new w(this.$refs.Modal),this.isNews=this.isNew}},x={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"Modal"},y={class:"modal-dialog",role:"document"},D={class:"modal-content"},I={class:"modal-header"},L={class:"modal-title",id:"exampleModalLabel"},U={key:0},N={key:1},R=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),S={class:"modal-body"},H={class:"mb-3"},O=o("label",{for:"title"},"標題",-1),B={class:"mb-3"},z=o("label",{for:"coupon_code"},"優惠碼",-1),F={class:"mb-3"},j=o("label",{for:"due_date"},"到期日",-1),W={class:"mb-3"},q=o("label",{for:"price"},"折扣百分比",-1),G={class:"mb-3"},J={class:"form-check"},K=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Q={class:"modal-footer"},X=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function Y(e,t,u,b,s,l){return d(),i("div",x,[o("div",y,[o("div",D,[o("div",I,[o("h5",L,[u.isNew?(d(),i("span",U,"新增優惠卷")):(d(),i("span",N,"編輯優惠卷"))]),R]),o("div",S,[o("div",H,[O,p(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=n=>s.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[r,s.tempCoupon.title]])]),o("div",B,[z,p(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=n=>s.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[r,s.tempCoupon.code]])]),o("div",F,[j,p(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=n=>s.tempCoupon.due_date=n)},null,512),[[r,s.tempCoupon.due_date]])]),o("div",W,[q,p(o("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=n=>s.tempCoupon.percent=n),placeholder:"請輸入折扣百分比"},null,512),[[r,s.tempCoupon.percent,void 0,{number:!0}]])]),o("div",G,[o("div",J,[p(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=n=>s.tempCoupon.is_enabled=n),id:"is_enabled"},null,512),[[g,s.tempCoupon.is_enabled]]),K])])]),o("div",Q,[X,o("button",{type:"button",class:"btn btn-info",onClick:t[5]||(t[5]=(...n)=>l.creatCoupon&&l.creatCoupon(...n))},c(u.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const Z=_(V,[["render",Y]]),{VITE_APP_URL:oo,VITE_APP_PATH:to}={VITE_APP_URL:"https://vue3-course-api.hexschool.io",VITE_APP_PATH:"wlc606",BASE_URL:"/vue_winter_week8_v4/",MODE:"production",DEV:!1,PROD:!0},eo={props:["coupon","getCoupons"],data(){return{tempCoupon:{title:"",is_enabled:1,percent:"",code:""},modal:""}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},delCoupon(){this.tempCoupon=this.coupon;const e=this.tempCoupon;this.$http.delete(`${oo}/v2/api/${to}/admin/coupon/${this.tempCoupon.id}`,{data:e}).then(t=>{this.hideModal(),this.getCoupons()}).catch(t=>{this.showErrorAlert(t)})},...h(m,["showErrorAlert"])},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.modal=new w(this.$refs.delCouponModal)}},so={class:"modal fade",id:"delCouponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"delCouponModal"},no={class:"modal-dialog",role:"document"},lo={class:"modal-content border-0"},io={class:"modal-header bg-danger text-white"},ao={class:"modal-title"},co=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),po={class:"modal-body"},uo={class:"text-danger"},ro={class:"modal-footer"},ho=o("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function _o(e,t,u,b,s,l){return d(),i("div",so,[o("div",no,[o("div",lo,[o("div",io,[o("h5",ao,[o("span",null,"刪除 "+c(this.coupon.title),1)]),co]),o("div",po,[C(" 是否刪除 "),o("strong",uo,c(this.coupon.title),1),C(" (刪除後將無法恢復)。 ")]),o("div",ro,[ho,o("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...n)=>l.delCoupon&&l.delCoupon(...n))},"確認刪除 ")])])])],512)}const mo=_(eo,[["render",_o]]),{VITE_APP_URL:bo,VITE_APP_PATH:Co}={VITE_APP_URL:"https://vue3-course-api.hexschool.io",VITE_APP_PATH:"wlc606",BASE_URL:"/vue_winter_week8_v4/",MODE:"production",DEV:!1,PROD:!0},fo={data(){return{isNew:"",coupons:[],tempCoupon:{title:"",is_enabled:0,percent:100,code:""}}},components:{CouponModal:Z,DelCouponmodal:mo},methods:{openCouponModal(e,t){this.isNew=e,this.tempCoupon.title="",this.tempCoupon.is_enabled="",this.tempCoupon.percent="",this.tempCoupon.code="",this.tempCoupon.due_date=new Date().getTime()/1e3,this.isNew?this.$refs.couponModal.openModal():(this.tempCoupon={...t},this.$refs.couponModal.openModal())},delCouponModal(e){this.tempCoupon={...e},this.$refs.delcouponModal.openModal()},getCoupons(){this.$http.get(`${bo}/v2/api/${Co}/admin/coupons`).then(e=>{this.coupons=e.data.coupons}).catch(e=>{this.showErrorAlert(e)})},...h(m,["showErrorAlert"])},mounted(){const e=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=e,this.getCoupons()}},$o={class:"admin-coupon container"},vo=o("h1",null,"優惠卷",-1),Po={class:"text-end mt-4"},wo={class:"table mt-4"},Ao=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),Mo={key:0,class:"text-success"},Eo={key:1,class:"text-muted"},go={class:"btn-group"},ko=["onClick"],To=["onClick"];function Vo(e,t,u,b,s,l){const n=$("CouponModal"),A=$("DelCouponmodal");return d(),i("div",$o,[vo,o("div",null,[o("div",Po,[o("button",{class:"btn btn-info",type:"button",onClick:t[0]||(t[0]=a=>l.openCouponModal(!0,e.item))}," 建立新的優惠券 ")]),o("table",wo,[Ao,o("tbody",null,[(d(!0),i(k,null,T(s.coupons,(a,M)=>(d(),i("tr",{key:M+"456"},[o("td",null,c(a.title),1),o("td",null,c(a.percent)+"%",1),o("td",null,c(new Date(a.due_date).toLocaleDateString("zh-TW")),1),o("td",null,[a.is_enabled===1?(d(),i("span",Mo,"啟用")):(d(),i("span",Eo,"未啟用"))]),o("td",null,[o("div",go,[o("button",{class:"btn btn-outline-info btn-sm",onClick:E=>l.openCouponModal(!1,a)},"編輯",8,ko),o("button",{class:"btn btn-outline-danger btn-sm",onClick:E=>l.delCouponModal(a)},"刪除",8,To)])])]))),128))])]),f(n,{ref:"couponModal","is-new":s.isNew,coupon:s.tempCoupon,"get-coupons":l.getCoupons},null,8,["is-new","coupon","get-coupons"]),f(A,{ref:"delcouponModal",coupon:s.tempCoupon,"get-coupons":l.getCoupons},null,8,["coupon","get-coupons"])])])}const Uo=_(fo,[["render",Vo]]);export{Uo as default};
